!function(t,o){"use strict";angular.module("adf.widget.scm",["adf.provider","chart.js","ngSanitize","btford.markdown"]).config(["dashboardProvider",function(t){var o="SCM-Manager",e={templateUrl:"{widgetsPath}/scm/src/edit/edit.html",controller:"ScmEditController",controllerAs:"vm",resolve:{repositories:["SCM",function(t){return t.getRepositories()}]}},i=function(t,o){var e=null;return o.repository&&(e=t.getRepository(o.repository)),e};i.$inject=["SCM","config"],t.widget("scm-commits-by-author",{title:"SCM Commits By Author",description:"Displays pie chart for commit count by author",category:o,templateUrl:"{widgetsPath}/scm/src/charts/pie-chart.html",controller:"CommitsByAuthorController",controllerAs:"vm",reload:!0,resolve:{repository:i,commitsByAuthor:["SCM","config",function(t,o){var e=null;return o.repository&&(e=t.getCommitsByAuthor(o.repository)),e}]},edit:e}).widget("scm-commits-by-month",{title:"SCM Commits By Month",description:"Displays line chart for commit count by month",category:o,templateUrl:"{widgetsPath}/scm/src/charts/line-chart.html",controller:"CommitsByMonthController",controllerAs:"vm",reload:!0,resolve:{repository:i,commitsByMonth:["SCM","config",function(t,o){var e=null;return o.repository&&(e=t.getCommitsByMonth(o.repository)),e}]},edit:e}).widget("scm-commits-last-commits",{title:"SCM Last Commit Chart",description:"Displays line chart for the last 50 commits",category:o,templateUrl:"{widgetsPath}/scm/src/charts/line-chart.html",controller:"LastCommitsController",controllerAs:"vm",reload:!0,resolve:{repository:i,commits:["SCM","config",function(t,o){var e=null;return o.repository&&(e=t.getCommits(o.repository,50)),e}]},edit:e}).widget("scm-commits",{title:"SCM Commits",description:"Displays last commits",category:o,templateUrl:"{widgetsPath}/scm/src/commits/view.html",controller:"CommitsController",controllerAs:"vm",reload:!0,resolve:{repository:i,commits:["SCM","config",function(t,o){var e=null;return o.repository&&(e=t.getCommits(o.repository,10)),e}]},edit:e}).widget("scm-activities",{title:"SCM Activities",description:"SCM Activities for all repositories",category:o,templateUrl:"{widgetsPath}/scm/src/activities/activityView.html",controller:"ActivitiesController",controllerAs:"vm",reload:!0,resolve:{activities:["SCM",function(t){var o=null;return o=t.getActivities()}]}}).widget("scm-markdown-content",{title:"SCM Markdown Content",description:"Displays a Markdown Content Preview",category:o,templateUrl:"{widgetsPath}/scm/src/markdownPreview/view.html",controller:"MarkdownPreviewController",controllerAs:"vm",reload:!0,resolve:{repository:i,fileContent:["SCM","config",function(t,o){var e=null;return o.repository&&o.path&&(e=t.getFileContent(o.repository,o.path)),e}]},edit:{templateUrl:"{widgetsPath}/scm/src/markdownPreview/edit.html",controller:"MarkdownPreviewEditController",controllerAs:"vm",resolve:{repositories:["SCM",function(t){return t.getRepositories()}]}}})}]),angular.module("adf.widget.scm").run(["$templateCache",function(t){t.put("{widgetsPath}/scm/src/activities/activityView.html",'<div><div ng-if=!vm.activities class="alert alert-info">There are no activities for your available repositories.</div><div ng-if="vm.status == 404 || vm.status == 500" class="alert alert-danger"><b>Error {{vm.status}}:</b> The endpoint could not be reached, this could mean that the activity plugin is not installed.</div><div ng-if=vm.activities><ul class=media-list><li class=media ng-repeat="activity in vm.activities"><div ng-if=vm.gravatarHash(activity) class=media-left><img class="media-object img-thumbnail" ng-src="https://www.gravatar.com/avatar/{{vm.gravatarHash(activity)}}?s=64&d=identicon"></div><div class=media-body><b>{{activity.repoName}}</b><p ng-bind-html=activity.changeset.description></p><small>{{activity.changeset.author.name}}, {{activity.changeset.date | date: \'yyyy-MM-dd HH:mm\'}}</small></div></li></ul></div></div>'),t.put("{widgetsPath}/scm/src/charts/line-chart.html",'<div><div class="alert alert-info" ng-if=!vm.chart>Please insert a repository path in the widget configuration</div><div ng-if="vm.repository.status == 404 || vm.repository.status == 500" class="alert alert-danger"><b>Error {{vm.repository.status}}</b> the endpoint could not be reached, this could mean that the selected repository does not exist or that the statistics plugin is not installed</div><div ng-if=vm.chart><canvas id=line class="chart chart-line" chart-data=vm.chart.data chart-labels=vm.chart.labels chart-series=vm.chart.series chart-options=vm.chart.options></canvas></div></div>'),t.put("{widgetsPath}/scm/src/charts/pie-chart.html",'<div><div class="alert alert-info" ng-if=!vm.chart>Please insert a repository path in the widget configuration</div><div ng-if="vm.repository.status == 404 || vm.repository.status == 500" class="alert alert-danger"><b>Error {{vm.repository.status}}</b> the endpoint could not be reached, this could mean that the selected repository does not exist or that the statistics plugin is not installed</div><div ng-if=vm.chart><canvas id=pie class="chart chart-pie" chart-legend=true chart-data=vm.chart.data chart-labels=vm.chart.labels chart-options=vm.chart.options></canvas></div></div>'),t.put("{widgetsPath}/scm/src/commits/view.html",'<div><div ng-if=!config.repository class="alert alert-info">Please configure a repository</div><div ng-if="vm.repository.status == 404 || vm.repository.status == 500" class="alert alert-danger"><b>Error {{vm.repository.status}}</b> the endpoint could not be reached, this could mean that the selected repository does not exist</div><div ng-if=config.repository><ul class=media-list><li class=media ng-repeat="commit in vm.commits"><div ng-if=vm.gravatarHash(commit) class=media-left><img class="media-object img-thumbnail" ng-src="https://www.gravatar.com/avatar/{{vm.gravatarHash(commit)}}?s=64&d=identicon"></div><div class=media-body><p ng-bind-html=commit.description></p><small>{{commit.author.name}}, {{commit.date | date: \'yyyy-MM-dd HH:mm\'}}</small></div></li></ul></div></div>'),t.put("{widgetsPath}/scm/src/edit/edit.html",'<form role=form><div class=form-group><label for=repository>Repository</label> <span class="grey glyphicon glyphicon-info-sign ng-scope" tabindex=0 ng-focus="repositoryTooltipIsOpen = !repositoryTooltipIsOpen" tooltip-trigger=outsideClick tooltip-is-open=repositoryTooltipIsOpen ng-mouseenter="repositoryTooltipIsOpen = !repositoryTooltipIsOpen" uib-tooltip-html=repositoryTooltip ng-mouseover="tooltipIsOpenRepo = !tooltipIsOpenRepo" tooltip-placement=top aria-label="Select a repository"></span><select name=repository id=repository class=form-control ng-model=config.repository required><option ng-repeat="repository in vm.repositories | orderBy: \'name\'" value={{repository.id}}>{{repository.name}}</option></select></div></form>'),t.put("{widgetsPath}/scm/src/markdownPreview/edit.html",'<form role=form><div class=form-group><p><label for=repository>Repository</label> <span class="grey glyphicon glyphicon-info-sign ng-scope" tabindex=0 ng-focus="repositoryTooltipIsOpen = !repositoryTooltipIsOpen" tooltip-trigger=outsideClick tooltip-is-open=repositoryTooltipIsOpen ng-mouseenter="repositoryTooltipIsOpen = !repositoryTooltipIsOpen" uib-tooltip-html=repositoryTooltip ng-mouseover="tooltipIsOpenRepo = !tooltipIsOpenRepo" tooltip-placement=top aria-label="Select a repository"></span><select name=repository id=repository class=form-control ng-model=config.repository ng-init=vm.getBranchesByRepositoryId(config.repository) ng-change=vm.getBranchesByRepositoryId(config.repository)><option ng-repeat="repository in vm.repositories | orderBy: \'name\'" value={{repository.id}}>{{repository.name}}</option></select></p><p ng-if=vm.branches><label for=branch>Branch</label> <span class="grey glyphicon glyphicon-info-sign ng-scope" tabindex=0 ng-focus="branchTooltipIsOpen = !branchTooltipIsOpen" tooltip-trigger=outsideClick uib-tooltip-html=branchTooltip ng-mouseover="branchTooltipIsOpen = !branchTooltipIsOpen" tooltip-placement=top tooltip-is-open=branchTooltipIsOpen aria-label="Select a branch"></span><select name=branch id=branch class=form-control ng-model=config.branch><option ng-repeat="branch in vm.branches| orderBy: \'name\'" value={{branch.id}}>{{branch.name}}</option></select></p><p ng-if=vm.branches><label for=path>Path to Markdown File</label> <span class="grey glyphicon glyphicon-info-sign ng-scope" tabindex=0 ng-focus="pathToMarkdownTooltipIsOpen = !pathToMarkdownTooltipIsOpen" tooltip-trigger=outsideClick uib-tooltip-html=pathToMarkdownTooltip ng-mouseover="pathToMarkdownTooltipIsOpen = !pathToMarkdownTooltipIsOpen" tooltip-is-open=pathToMarkdownTooltipIsOpen tooltip-placement=top aria-label="Enter a valid path to a markdown file"></span> <input type=text class=form-control id=path ng-model=config.path required></p></div></form>'),t.put("{widgetsPath}/scm/src/markdownPreview/view.html",'<style>\n  div.markdownContent{\n    overflow: auto;\n    width: 100%;\n  }\n</style><div class="alert alert-info" ng-if="vm.fileContent === null">Configure a specific file</div><div ng-if=vm.fileContent btf-markdown=vm.fileContent class=markdownContent></div><div class="alert alert-danger" ng-if="vm.fileContent.status == 500 || vm.fileContent.status == 404"><b>Error {{vm.fileContent.status}}</b> The Markdown file was not found. This may be because the file does not exist or the SCM Manager is not available at the moment.</div>')}]),angular.module("adf.widget.scm").controller("MarkdownPreviewEditController",["repositories","SCM","$scope","$sce",function(t,o,e,i){var r=this;r.repositories=t,e.repositoryTooltip=i.trustAsHtml("Select the repository. If none is shown, check your scm configuration."),e.branchTooltip=i.trustAsHtml("Select the branch."),e.pathToMarkdownTooltip=i.trustAsHtml("Add <b>NO</b> leading slash to the file path. The path is <b>case sensitive</b>."),r.getBranchesByRepositoryId=function(t){t&&o.getBranchesByRepositoryId(t).then(function(t){400==t.status?r.branches=null:r.branches=t.branch})}}]),angular.module("adf.widget.scm").controller("MarkdownPreviewController",["repository","fileContent",function(t,o){var e=this;e.repository=t,e.fileContent=o}]),angular.module("adf.widget.scm").controller("ScmEditController",["repositories","$scope","$sce",function(t,o,e){var i=this;o.repositoryTooltip=e.trustAsHtml("Select the repository."),i.repositories=t}]),angular.module("adf.widget.scm").controller("CommitsController",["$sce","config","repository","commits","SCM",function(t,o,e,i,r){var s=this;s.repository=e,angular.forEach(i,function(o){o.description=t.trustAsHtml(o.description)}),s.commits=i,s.gravatarHash=function(t){return r.getGravatarHash(t.properties)}}]),angular.module("adf.widget.scm").controller("LastCommitsController",["$filter","config","repository","commits",function(t,o,e,i){function r(){var t={scales:{yAxes:[{id:"y-axis-1",display:!0,position:"left",ticks:{fixedStepSize:1},scaleLabel:{display:!0,labelString:"Commits"}}]},legend:{display:!0,position:"bottom"},responsive:!0},o=[],e={labels:[],data:[o],series:["Commits"],"class":"chart-line",options:t},r={};return angular.forEach(i,function(t){var o=new Date(t.date),e=o.getUTCFullYear()+"-"+(o.getUTCMonth()+1)+"-"+o.getUTCDate(),i=r[e];i?i.count+=1:r[e]={date:e,count:1}}),angular.forEach(r,function(t){e.labels.push(t.date),o.push(t.count)}),e.labels.reverse(),o.reverse(),e}var s=this;s.repository=e,e&&i&&(s.chart=r())}]),angular.module("adf.widget.scm").controller("CommitsByMonthController",["config","repository","commitsByMonth",function(t,o,e){function i(){var t=[],o={scales:{yAxes:[{id:"y-axis-1",display:!0,position:"left",ticks:{fixedStepSize:1},scaleLabel:{display:!0,labelString:"Commits"}}]},legend:{display:!0,position:"bottom"},responsive:!0},i={labels:[],data:[t],series:["Commits"],"class":"chart-line",options:o};return angular.forEach(e.month,function(o){i.labels.push(o.value),t.push(o.count)}),i}var r=this;r.repository=o,e&&(r.chart=i())}]),angular.module("adf.widget.scm").controller("CommitsByAuthorController",["config","repository","commitsByAuthor",function(t,o,e){function i(){var t={};angular.forEach(e.author,function(o){var e=o.value;t[e]=o.count});var o={legend:{display:!0,position:"bottom"},responsive:!0},i={labels:[],data:[],series:["Commits"],"class":"chart-pie",options:o};return angular.forEach(t,function(t,o){i.labels.push(o),i.data.push(t)}),i}var r=this;r.repository=o,o&&e&&(r.chart=i())}]),angular.module("adf.widget.scm").controller("ActivitiesController",["$sce","activities","SCM",function(t,o,e){var i=this;i.status=o.status,angular.forEach(o.activities,function(o){o.changeset.description=t.trustAsHtml(o.changeset.description),o.repoName=o["repository-name"]}),o.activities&&(i.activities=o.activities.slice(0,15)),i.gravatarHash=function(t){return e.getGravatarHash(t.changeset.properties)}}]),angular.module("adf.widget.scm").factory("SCM",["scmEndpoint","$http",function(t,o){function e(e){return o.get(t+e).then(function(t){if(200===t.status)return t.data},function(t){return t})}function i(){return e("repositories.json")}function r(t){return e("repositories/"+t+".json")}function s(t){return e("plugins/statistic/"+t+"/commits-per-author.json")}function a(t){return e("plugins/statistic/"+t+"/commits-per-month.json")}function n(t,o){return e("repositories/"+t+"/changesets.json?limit="+o).then(function(t){return t.changesets})}function l(){return e("activity.json")}function c(t,o){return e("repositories/"+t+"/content?path="+o)}function p(t){return e("repositories/"+t+"/branches")}function m(t){var o;if(t)for(var e=0;e<t.length;e++)if("gravatar-hash"===t[0].key){o=t[0].value;break}return o}return{getRepositories:i,getRepository:r,getCommitsByAuthor:s,getCommitsByMonth:a,getCommits:n,getActivities:l,getFileContent:c,getBranchesByRepositoryId:p,getGravatarHash:m}}])}(window);
//# sourceMappingURL=adf-widget-scm.min.js.map
