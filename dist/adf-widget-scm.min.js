!function(t,o){"use strict";angular.module("adf.widget.scm",["adf.provider","highcharts-ng"]).config(["dashboardProvider",function(t){var o={templateUrl:"{widgetsPath}/scm/src/edit/edit.html",controller:"ScmEditController",controllerAs:"vm",resolve:{repositories:function(t){return t.getRepositories()}}},r=function(t,o){var r=null;return o.repository&&(r=t.getRepository(o.repository)),r};r.$inject=["SCM","config"],t.widget("scm-commits-by-author",{title:"SCM Commits By Author",description:"SCM-Manager pie chart for commit count by author",templateUrl:"{widgetsPath}/scm/src/charts/chart.html",controller:"CommitsByAuthorController",controllerAs:"vm",reload:!0,resolve:{repository:r,commitsByAuthor:["SCM","config",function(t,o){var r=null;return o.repository&&(r=t.getCommitsByAuthor(o.repository)),r}]},edit:o}).widget("scm-commits-by-month",{title:"SCM Commits By Month",description:"SCM-Manager line chart for commit count by month",templateUrl:"{widgetsPath}/scm/src/charts/chart.html",controller:"CommitsByMonthController",controllerAs:"vm",reload:!0,resolve:{repository:r,commitsByMonth:["SCM","config",function(t,o){var r=null;return o.repository&&(r=t.getCommitsByMonth(o.repository)),r}]},edit:o}).widget("scm-commits-last-commits",{title:"SCM Commits line chart",description:"SCM-Manager line char for the last 50 commits",templateUrl:"{widgetsPath}/scm/src/charts/chart.html",controller:"LastCommitsController",controllerAs:"vm",reload:!0,resolve:{repository:r,commits:["SCM","config",function(t,o){var r=null;return o.repository&&(r=t.getCommits(o.repository,50)),r}]},edit:o}).widget("scm-commits",{title:"SCM Commits",description:"SCM-Manager commits",templateUrl:"{widgetsPath}/scm/src/commits/view.html",controller:"CommitsController",controllerAs:"vm",reload:!0,resolve:{repository:r,commits:["SCM","config",function(t,o){var r=null;return o.repository&&(r=t.getCommits(o.repository,10)),r}]},edit:o})}]),angular.module("adf.widget.scm").run(["$templateCache",function(t){t.put("{widgetsPath}/scm/src/charts/chart.html",'<div><div ng-if=!config.repository class="alert alert-info">Please configure a repository</div><div ng-if=config.repository><highchart config=vm.chartConfig></highchart></div></div>'),t.put("{widgetsPath}/scm/src/commits/view.html",'<div><div ng-if=!config.repository class="alert alert-info">Please configure a repository</div><div ng-if=config.repository><ul class=media-list><li class=media ng-repeat="commit in vm.commits"><div ng-if=vm.gravatarHash(commit) class=media-left><img class="media-object img-thumbnail" ng-src="http://www.gravatar.com/avatar/{{vm.gravatarHash(commit)}}?s=64&d=identicon"></div><div class=media-body><p>{{commit.description}}</p><small>{{commit.author.name}}, {{commit.date | date: \'yyyy-MM-dd HH:mm\'}}</small></div></li></ul></div></div>'),t.put("{widgetsPath}/scm/src/edit/edit.html","<form role=form><div class=form-group><label for=repository>Repository</label><select name=repository id=repository class=form-control ng-model=config.repository><option ng-repeat=\"repository in vm.repositories | orderBy: 'name'\" value={{repository.id}}>{{repository.name}}</option></select></div></form>")}]),angular.module("adf.widget.scm").controller("ScmEditController",["repositories",function(t){var o=this;o.repositories=t}]),angular.module("adf.widget.scm").controller("CommitsController",["config","repository","commits",function(t,o,r){var e=this;e.repository=o,e.commits=r,e.gravatarHash=function(t){var o;if(t.properties)for(var r=0;r<t.properties.length;r++)if("gravatar-hash"===t.properties[0].key){o=t.properties[0].value;break}return o}}]),angular.module("adf.widget.scm").controller("LastCommitsController",["config","repository","commits",function(t,o,r){var e=this;if(o&&r){var i={};angular.forEach(r,function(t){var o=new Date(t.date),r=o.getUTCFullYear()+"-"+(o.getUTCMonth()+1)+"-"+o.getUTCDate(),e=i[r];e?e.count+=1:i[r]={count:1,date:Date.UTC(o.getUTCFullYear(),o.getUTCMonth(),o.getUTCDate())}});var n=[];angular.forEach(i,function(t){n.push([t.date,t.count])}),n.length>0&&n.sort(function(t,o){return t[0]-o[0]}),e.chartConfig={chart:{type:"spline"},title:{text:o.name+" last commits"},xAxis:{type:"datetime",dateTimeLabelFormats:{month:"%Y-%m"},title:{text:"Month"}},yAxis:{title:{text:"Commits"},min:0},series:[{name:o.name,data:n}]}}}]),angular.module("adf.widget.scm").controller("CommitsByMonthController",["config","repository","commitsByMonth",function(t,o,r){function e(t){var o=t.split("-");return Date.UTC(parseInt(o[0]),parseInt(o[1]),1)}var i=this;if(o&&r){var n=[];angular.forEach(r.month,function(t){"1970-01"!==t.value&&n.push([e(t.value),t.count])}),i.chartConfig={chart:{type:"spline"},title:{text:o.name+" commit history"},xAxis:{type:"datetime",dateTimeLabelFormats:{month:"%Y-%m"},title:{text:"Month"}},yAxis:{title:{text:"Commits"},min:0},series:[{name:o.name,data:n}]}}}]),angular.module("adf.widget.scm").controller("CommitsByAuthorController",["config","repository","commitsByAuthor",function(t,o,r){var e=this;if(o&&r){var i=[];angular.forEach(r.author,function(t){i.push({name:t.value,y:t.count})}),i.length>0&&(i.sort(function(t,o){return o.y-t.y}),i[0].sliced=!0,i[0].selected=!0),e.chartConfig={chart:{plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},title:{text:o.name},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,color:"#000000",connectorColor:"#000000",format:"<b>{point.name}</b>: {point.percentage:.1f} %"}}},series:[{type:"pie",name:o.name,data:i}]}}}]),angular.module("adf.widget.scm").factory("SCM",["$http",function(t){function o(t){return t.data}function r(r){return t.get(m+r).then(o)}function e(){return r("repositories.json")}function i(t){return r("repositories/"+t+".json")}function n(t){return r("plugins/statistic/"+t+"/commits-per-author.json")}function s(t){return r("plugins/statistic/"+t+"/commits-per-month.json")}function a(t,o){return r("repositories/"+t+"/changesets.json?limit="+o).then(function(t){return t.changesets})}var m="/api/scm/";return{getRepositories:e,getRepository:i,getCommitsByAuthor:n,getCommitsByMonth:s,getCommits:a}}])}(window);
//# sourceMappingURL=adf-widget-scm.min.js.map
