!function(t,e){"use strict";angular.module("adf.widget.scm",["adf.provider","chart.js","ngSanitize","btford.markdown"]).config(["dashboardProvider",function(t){var e="SCM-Manager",o={templateUrl:"{widgetsPath}/scm/src/edit/edit.html",controller:"ScmEditController",controllerAs:"vm",resolve:{repositories:["SCM",function(t){return t.getRepositories()}]}},i=function(t,e){var o=null;return e.repository&&(o=t.getRepository(e.repository)),o};i.$inject=["SCM","config"],t.widget("scm-commits-by-author",{title:"SCM Commits By Author",description:"Displays pie chart for commit count by author",category:e,templateUrl:"{widgetsPath}/scm/src/charts/pie-chart.html",controller:"CommitsByAuthorController",controllerAs:"vm",reload:!0,resolve:{repository:i,commitsByAuthor:["SCM","config",function(t,e){var o=null;return e.repository&&(o=t.getCommitsByAuthor(e.repository)),o}]},edit:o}).widget("scm-commits-by-month",{title:"SCM Commits By Month",description:"Displays line chart for commit count by month",category:e,templateUrl:"{widgetsPath}/scm/src/charts/line-chart.html",controller:"CommitsByMonthController",controllerAs:"vm",reload:!0,resolve:{repository:i,commitsByMonth:["SCM","config",function(t,e){var o=null;return e.repository&&(o=t.getCommitsByMonth(e.repository)),o}]},edit:o}).widget("scm-commits-last-commits",{title:"SCM Last Commit Chart",description:"Displays line chart for the last 50 commits",category:e,templateUrl:"{widgetsPath}/scm/src/charts/line-chart.html",controller:"LastCommitsController",controllerAs:"vm",reload:!0,resolve:{repository:i,commits:["SCM","config",function(t,e){var o=null;return e.repository&&(o=t.getCommits(e.repository,50)),o}]},edit:o}).widget("scm-commits",{title:"SCM Commits",description:"Displays last commits",category:e,templateUrl:"{widgetsPath}/scm/src/commits/view.html",controller:"CommitsController",controllerAs:"vm",reload:!0,resolve:{repository:i,commits:["SCM","config",function(t,e){var o=null;return e.repository&&(o=t.getCommits(e.repository,10)),o}]},edit:o}).widget("scm-activities",{title:"SCM Activities",description:"SCM Activities for all repositories",category:e,templateUrl:"{widgetsPath}/scm/src/activities/activityView.html",controller:"ActivitiesController",controllerAs:"vm",reload:!0,resolve:{activities:["SCM",function(t){var e=null;return e=t.getActivities()}]}}).widget("scm-markdown-content",{title:"SCM Markdown Content",description:"Displays a Markdown Content Preview",category:e,templateUrl:"{widgetsPath}/scm/src/markdownPreview/view.html",controller:"MarkdownPreviewController",controllerAs:"vm",reload:!0,resolve:{repository:i,fileContent:["SCM","config",function(t,e){var o=null;return e.repository&&e.path&&(o=t.getFileContent(e.repository,e.path)),o}]},edit:{templateUrl:"{widgetsPath}/scm/src/markdownPreview/edit.html",controller:"MarkdownPreviewEditController",controllerAs:"vm",resolve:{repositories:["SCM",function(t){return t.getRepositories()}]}}})}]),angular.module("adf.widget.scm").run(["$templateCache",function(t){t.put("{widgetsPath}/scm/src/activities/activityView.html",'<div><div ng-if=!vm.activities class="alert alert-info">There are no activities for your available repositories.</div><div ng-if="vm.status == 404 || vm.status == 500" class="alert alert-danger"><b>Error {{vm.status}}:</b> The endpoint could not be reached, this could mean that the activity plugin is not installed.</div><div ng-if=vm.activities><ul class=media-list><li class=media ng-repeat="activity in vm.activities"><div ng-if=vm.gravatarHash(activity) class=media-left><img class="media-object img-thumbnail" ng-src="https://www.gravatar.com/avatar/{{vm.gravatarHash(activity)}}?s=64&d=identicon"></div><div class=media-body><b>{{activity.repoName}}</b><p ng-bind-html=activity.changeset.description></p><small>{{activity.changeset.author.name}}, {{activity.changeset.date | date: \'yyyy-MM-dd HH:mm\'}}</small></div></li></ul></div></div>'),t.put("{widgetsPath}/scm/src/charts/line-chart.html",'<div><div class="alert alert-info" ng-if=!vm.chart>Please insert a repository path in the widget configuration</div><div ng-if="vm.repository.status == 404 || vm.repository.status == 500" class="alert alert-danger"><b>Error {{vm.repository.status}}</b> the endpoint could not be reached, this could mean that the selected repository does not exist or that the statistics plugin is not installed</div><div ng-if=vm.chart><canvas id=line class="chart chart-line" chart-data=vm.chart.data chart-labels=vm.chart.labels chart-series=vm.chart.series chart-options=vm.chart.options></canvas></div></div>'),t.put("{widgetsPath}/scm/src/charts/pie-chart.html",'<div><div class="alert alert-info" ng-if=!vm.chart>Please insert a repository path in the widget configuration</div><div ng-if="vm.repository.status == 404 || vm.repository.status == 500" class="alert alert-danger"><b>Error {{vm.repository.status}}</b> the endpoint could not be reached, this could mean that the selected repository does not exist or that the statistics plugin is not installed</div><div ng-if=vm.chart><canvas id=pie class="chart chart-pie" chart-legend=true chart-data=vm.chart.data chart-labels=vm.chart.labels chart-options=vm.chart.options></canvas></div></div>'),t.put("{widgetsPath}/scm/src/commits/view.html",'<div><div ng-if=!config.repository class="alert alert-info">Please configure a repository</div><div ng-if="vm.repository.status == 404 || vm.repository.status == 500" class="alert alert-danger"><b>Error {{vm.repository.status}}</b> the endpoint could not be reached, this could mean that the selected repository does not exist</div><div ng-if=config.repository><ul class=media-list><li class=media ng-repeat="commit in vm.commits"><div ng-if=vm.gravatarHash(commit) class=media-left><img class="media-object img-thumbnail" ng-src="https://www.gravatar.com/avatar/{{vm.gravatarHash(commit)}}?s=64&d=identicon"></div><div class=media-body><p ng-bind-html=commit.description></p><small>{{commit.author.name}}, {{commit.date | date: \'yyyy-MM-dd HH:mm\'}}</small></div></li></ul></div></div>'),t.put("{widgetsPath}/scm/src/edit/edit.html",'<form role=form><div class=form-group><label for=repository>Repository</label> <span class="grey glyphicon glyphicon-info-sign ng-scope" tabindex=0 ng-focus="repositoryTooltipIsOpen = !repositoryTooltipIsOpen" tooltip-trigger=outsideClick tooltip-is-open=repositoryTooltipIsOpen ng-mouseenter="repositoryTooltipIsOpen = !repositoryTooltipIsOpen" uib-tooltip-html=repositoryTooltip ng-mouseover="tooltipIsOpenRepo = !tooltipIsOpenRepo" tooltip-placement=top aria-label="A valid URL to your Jenkins server must be stored here"></span><select name=repository id=repository class=form-control ng-model=config.repository required><option ng-repeat="repository in vm.repositories | orderBy: \'name\'" value={{repository.id}}>{{repository.name}}</option></select></div></form>'),t.put("{widgetsPath}/scm/src/markdownPreview/edit.html",'<form role=form><div class=form-group><p><label for=repository>Repository</label> <span class="grey glyphicon glyphicon-info-sign ng-scope" tabindex=0 ng-focus="repositoryTooltipIsOpen = !repositoryTooltipIsOpen" tooltip-trigger=outsideClick tooltip-is-open=repositoryTooltipIsOpen ng-mouseenter="repositoryTooltipIsOpen = !repositoryTooltipIsOpen" uib-tooltip-html=repositoryTooltip ng-mouseover="tooltipIsOpenRepo = !tooltipIsOpenRepo" tooltip-placement=top aria-label="A valid URL to your Jenkins server must be stored here"></span><select name=repository id=repository class=form-control ng-model=config.repository ng-init=vm.getBranchesByRepositoryId(config.repository) ng-change=vm.getBranchesByRepositoryId(config.repository)><option ng-repeat="repository in vm.repositories | orderBy: \'name\'" value={{repository.id}}>{{repository.name}}</option></select></p><p ng-if=vm.branches><label for=branch>Branch</label> <span class="grey glyphicon glyphicon-info-sign ng-scope" tabindex=0 ng-focus="branchTooltipIsOpen = !branchTooltipIsOpen" tooltip-trigger=outsideClick uib-tooltip-html=branchTooltip ng-mouseover="branchTooltipIsOpen = !branchTooltipIsOpen" tooltip-placement=top tooltip-is-open=branchTooltipIsOpen aria-label="A valid URL to your Jenkins server must be stored here"></span><select name=branch id=branch class=form-control ng-model=config.branch><option ng-repeat="branch in vm.branches| orderBy: \'name\'" value={{branch.id}}>{{branch.name}}</option></select></p><p><label for=path>Path to Markdown File</label> <span class="grey glyphicon glyphicon-info-sign ng-scope" tabindex=0 ng-focus="pathToMarkdownTooltipIsOpen = !pathToMarkdownTooltipIsOpen" tooltip-trigger=outsideClick uib-tooltip-html=pathToMarkdownTooltip ng-mouseover="pathToMarkdownTooltipIsOpen = !pathToMarkdownTooltipIsOpen" tooltip-is-open=pathToMarkdownTooltipIsOpen tooltip-placement=top aria-label="A valid URL to your Jenkins server must be stored here"></span> <input type=text class=form-control id=path ng-model=config.path required></p></div></form>'),t.put("{widgetsPath}/scm/src/markdownPreview/view.html",'<style>\n  div.markdownContent{\n    overflow: auto;\n    width: 100%;\n  }\n</style><div class="alert alert-info" ng-if="vm.fileContent === null">Please configure a specific file</div><div ng-if=vm.fileContent btf-markdown=vm.fileContent class=markdownContent></div><div class="alert alert-danger" ng-if="vm.fileContent.status == 500 || vm.fileContent.status == 404"><b>Error {{vm.fileContent.status}}</b> The Markdown file was not found. This may be because the file does not exist or the SCM Manager is not available at the moment.</div>')}]),angular.module("adf.widget.scm").controller("MarkdownPreviewEditController",["repositories","SCM","$scope","$sce",function(t,e,o,i){var r=this;r.repositories=t,o.repositoryTooltip=i.trustAsHtml("Select the repository which stores the desired Markdown."),o.branchTooltip=i.trustAsHtml("Select the branch on which the desired Markdown file can be found."),o.pathToMarkdownTooltip=i.trustAsHtml("The path where the Markdown file can be found within the repository (e.g. <b>docs/File.md</b>)."),r.getBranchesByRepositoryId=function(t){t&&e.getBranchesByRepositoryId(t).then(function(t){400==t.status?r.branches=null:r.branches=t.branch})}}]),angular.module("adf.widget.scm").controller("MarkdownPreviewController",["repository","fileContent",function(t,e){var o=this;o.repository=t,o.fileContent=e}]),angular.module("adf.widget.scm").controller("ScmEditController",["repositories","$scope","$sce",function(t,e,o){var i=this;e.repositoryTooltip=o.trustAsHtml("Select the repository which is used to provide data."),i.repositories=t}]),angular.module("adf.widget.scm").controller("CommitsController",["$sce","config","repository","commits","SCM",function(t,e,o,i,r){var s=this;s.repository=o,angular.forEach(i,function(e){e.description=t.trustAsHtml(e.description)}),s.commits=i,s.gravatarHash=function(t){return r.getGravatarHash(t.properties)}}]),angular.module("adf.widget.scm").controller("LastCommitsController",["$filter","config","repository","commits",function(t,e,o,i){function r(){var t={scales:{yAxes:[{id:"y-axis-1",display:!0,position:"left",ticks:{fixedStepSize:1},scaleLabel:{display:!0,labelString:"Commits"}}]},legend:{display:!0,position:"bottom"},responsive:!0},e=[],o={labels:[],data:[e],series:["Commits"],"class":"chart-line",options:t},r={};return angular.forEach(i,function(t){var e=new Date(t.date),o=e.getUTCFullYear()+"-"+(e.getUTCMonth()+1)+"-"+e.getUTCDate(),i=r[o];i?i.count+=1:r[o]={date:o,count:1}}),angular.forEach(r,function(t){o.labels.push(t.date),e.push(t.count)}),o.labels.reverse(),e.reverse(),o}var s=this;s.repository=o,o&&i&&(s.chart=r())}]),angular.module("adf.widget.scm").controller("CommitsByMonthController",["config","repository","commitsByMonth",function(t,e,o){function i(){var t=[],e={scales:{yAxes:[{id:"y-axis-1",display:!0,position:"left",ticks:{fixedStepSize:1},scaleLabel:{display:!0,labelString:"Commits"}}]},legend:{display:!0,position:"bottom"},responsive:!0},i={labels:[],data:[t],series:["Commits"],"class":"chart-line",options:e};return angular.forEach(o.month,function(e){i.labels.push(e.value),t.push(e.count)}),i}var r=this;r.repository=e,o&&(r.chart=i())}]),angular.module("adf.widget.scm").controller("CommitsByAuthorController",["config","repository","commitsByAuthor",function(t,e,o){function i(){var t={};angular.forEach(o.author,function(e){var o=e.value;t[o]=e.count});var e={legend:{display:!0,position:"bottom"},responsive:!0},i={labels:[],data:[],series:["Commits"],"class":"chart-pie",options:e};return angular.forEach(t,function(t,e){i.labels.push(e),i.data.push(t)}),i}var r=this;r.repository=e,e&&o&&(r.chart=i())}]),angular.module("adf.widget.scm").controller("ActivitiesController",["$sce","activities","SCM",function(t,e,o){var i=this;i.status=e.status,angular.forEach(e.activities,function(e){e.changeset.description=t.trustAsHtml(e.changeset.description),e.repoName=e["repository-name"]}),e.activities&&(i.activities=e.activities.slice(0,15)),i.gravatarHash=function(t){return o.getGravatarHash(t.changeset.properties)}}]),angular.module("adf.widget.scm").factory("SCM",["scmEndpoint","$http",function(t,e){function o(o){return e.get(t+o).then(function(t){if(200===t.status)return t.data},function(t){return t})}function i(){return o("repositories.json")}function r(t){return o("repositories/"+t+".json")}function s(t){return o("plugins/statistic/"+t+"/commits-per-author.json")}function a(t){return o("plugins/statistic/"+t+"/commits-per-month.json")}function n(t,e){return o("repositories/"+t+"/changesets.json?limit="+e).then(function(t){return t.changesets})}function l(){return o("activity.json")}function c(t,e){return o("repositories/"+t+"/content?path="+e)}function p(t){return o("repositories/"+t+"/branches")}function m(t){var e;if(t)for(var o=0;o<t.length;o++)if("gravatar-hash"===t[0].key){e=t[0].value;break}return e}return{getRepositories:i,getRepository:r,getCommitsByAuthor:s,getCommitsByMonth:a,getCommits:n,getActivities:l,getFileContent:c,getBranchesByRepositoryId:p,getGravatarHash:m}}])}(window);
//# sourceMappingURL=adf-widget-scm.min.js.map
